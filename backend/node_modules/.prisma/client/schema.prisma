generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model categories {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id         String            @db.Uuid
  name            String            @db.VarChar(100)
  description     String?           @db.VarChar(255)
  type            String            @db.VarChar(20)
  color           String?           @default("#888888") @db.VarChar(20)
  active          Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamp(6)
  users           users             @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recurring_rules recurring_rules[]
  transactions    transactions[]

  @@unique([user_id, name, type], map: "unique_category_per_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model installment_groups {
  id                 String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id            String         @db.Uuid
  description        String?        @db.VarChar(255)
  total_amount       Decimal        @db.Decimal(12, 2)
  total_installments Int
  created_at         DateTime?      @default(now()) @db.Timestamp(6)
  users              users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transactions       transactions[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model recurring_rules {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String         @db.Uuid
  category_id  String?        @db.Uuid
  description  String         @db.VarChar(255)
  amount       Decimal        @db.Decimal(12, 2)
  type         String         @db.VarChar(20)
  day_of_month Int
  start_date   DateTime
  end_date     DateTime?
  active       Boolean?       @default(true)
  created_at   DateTime?      @default(now()) @db.Timestamp(6)
  categories   categories?    @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  users        users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  transactions transactions[]

  @@index([user_id, active], map: "idx_recurring_user_active")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model transactions {
  id                   String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id              String              @db.Uuid
  category_id          String?             @db.Uuid
  description          String              @db.VarChar(255)
  amount               Decimal             @db.Decimal(12, 2)
  date                 DateTime            @default(now())
  type                 String              @db.VarChar(20)
  installment_group_id String?             @db.Uuid
  installment_number   Int?
  recurring_rule_id    String?             @db.Uuid
  created_at           DateTime?           @default(now()) @db.Timestamp(6)
  categories           categories?         @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  installment_groups   installment_groups? @relation(fields: [installment_group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recurring_rules      recurring_rules?    @relation(fields: [recurring_rule_id], references: [id], onUpdate: NoAction)
  users                users               @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id, category_id], map: "idx_transactions_user_category")
  @@index([user_id, date], map: "idx_transactions_user_date")
}

model users {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String               @db.VarChar(255)
  email              String               @unique @db.VarChar(255)
  password_hash      String               @db.VarChar(255)
  created_at         DateTime?            @default(now()) @db.Timestamp(6)
  categories         categories[]
  installment_groups installment_groups[]
  recurring_rules    recurring_rules[]
  transactions       transactions[]
}
